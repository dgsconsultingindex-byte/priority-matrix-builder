<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- Primary Meta Tags -->
  <title>PrioBox - Smart Task Management & Eisenhower Matrix App</title>
  <meta name="title" content="PrioBox - Smart Task Management & Eisenhower Matrix App">
  <meta name="description" content="Focus on what truly matters with PrioBox. AI-powered task prioritization using the Eisenhower Matrix. Track productivity, build consistency streaks, and eliminate distractions.">
  <meta name="keywords" content="task management, productivity app, eisenhower matrix, priority management, focus timer, task prioritization, productivity tool, time management">
  <meta name="author" content="PrioBox">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://priobox.app/">
  <meta property="og:title" content="PrioBox - Smart Task Management & Eisenhower Matrix App">
  <meta property="og:description" content="Focus on what truly matters with PrioBox. AI-powered task prioritization using the Eisenhower Matrix. Track productivity, build consistency streaks, and eliminate distractions.">
  <meta property="og:image" content="https://priobox.app/og-image.png">
  <meta property="og:site_name" content="PrioBox">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://priobox.app/">
  <meta property="twitter:title" content="PrioBox - Smart Task Management & Eisenhower Matrix App">
  <meta property="twitter:description" content="Focus on what truly matters with PrioBox. AI-powered task prioritization using the Eisenhower Matrix. Track productivity, build consistency streaks, and eliminate distractions.">
  <meta property="twitter:image" content="https://priobox.app/twitter-image.png">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://priobox.app/">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='8' y='8' width='38' height='38' rx='6' fill='%23ef4444'/><rect x='54' y='8' width='38' height='38' rx='6' fill='%23f59e0b'/><rect x='8' y='54' width='38' height='38' rx='6' fill='%2310b981'/><rect x='54' y='54' width='38' height='38' rx='6' fill='%233b82f6'/></svg>'>

 
  <!-- Performance Optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  
  <style>
    :root {
      --bg: #fafbfc;
      --panel: #ffffff;
      --text: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --accent-light: #eff6ff;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --sidebar-width: 240px;
      --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    /* Dark theme overrides (applies when html[data-theme="dark"]) */
    html[data-theme='dark'] {
      --bg: #071024;
      --panel: #0b1220;
      --text: #e6eef8;
      --text-muted: #94a3b8;
      --border: #1f2937;
      --accent: #60a5fa;
      --accent-hover: #3b82f6;
      --accent-light: rgba(59,130,246,0.08);
      --success: #34d399;
      --danger: #fb7185;
      --warning: #f59e0b;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.6);
      --shadow-md: 0 6px 10px rgba(0,0,0,0.6);
      --shadow-lg: 0 14px 30px rgba(0,0,0,0.7);
    }

    /* Smooth transitions when switching theme */
    html, body, .sidebar, .main-content, .panel, .section, .task, .modal, .hero-card {
      transition: background-color 240ms ease, color 240ms ease, border-color 240ms ease, box-shadow 240ms ease;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; overflow: hidden; }
    .app-container { display: flex; height: 100vh; }
    
    /* Sidebar */
    .sidebar { width: var(--sidebar-width); background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; box-shadow: var(--shadow-sm); }
    .logo { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
    .logo h1 { margin: 0; font-size: 20px; font-weight: 700; }
    .nav { flex: 1; padding: 12px 0; overflow-y: auto; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; font-size: 14px; font-weight: 500; color: var(--text); }
    .nav-item:hover { background: var(--bg); color: var(--text); }
    .nav-item.active { background: var(--accent-light); color: var(--accent); border-left-color: var(--accent); }
    .nav-icon { font-size: 18px; width: 24px; text-align: center; }
    .nav-badge { margin-left: auto; background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 700; }
    .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); }
    
    /* Main Content */
    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .top-bar { background: var(--panel); border-bottom: 1px solid var(--border); padding: 16px 24px; display: flex; align-items: center; gap: 16px; box-shadow: var(--shadow-sm); }
    .search-bar { flex: 1; max-width: 500px; position: relative; }
    .search-bar input { width: 100%; padding: 10px 40px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.2s; }
    .search-bar input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
    .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
    .search-kbd { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 11px; color: var(--text-muted); background: var(--bg); padding: 2px 6px; border-radius: 4px; border: 1px solid var(--border); }
    .btn { padding: 10px 18px; border: 1px solid var(--border); background: var(--panel); color: var(--text); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.12s; display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { background: var(--bg); transform: translateY(-1px); box-shadow: var(--shadow-md); }
    .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-icon { padding: 10px; }
    .content-area { flex: 1; overflow-y: auto; padding: 24px; }
    
    /* Stats */
    .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .stat-mini { background: var(--panel); padding: 16px; border-radius: 10px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
    .stat-mini:hover { box-shadow: var(--shadow-md); }
    .stat-mini-label { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
    .stat-mini-value { font-size: 24px; font-weight: 700; }
    .stat-mini-icon { font-size: 32px; opacity: 0.3; }
    
    /* Section */
    .section { background: var(--panel); border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; overflow: hidden; }
    .section-header { padding: 16px 20px; background: var(--bg); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .section-title { font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .section-actions { display: flex; gap: 8px; }
    .section-content { padding: 16px; }
    
    /* Tasks */
    .task-list { display: flex; flex-direction: column; gap: 8px; }
    .task { background: var(--panel); padding: 14px 16px; border-radius: 8px; border: 1px solid var(--border); display: flex; align-items: flex-start; gap: 12px; transition: all 0.2s; cursor: pointer; }
    .task:hover { box-shadow: var(--shadow-md); border-color: var(--accent); transform: translateX(2px); }
    .task.completed { opacity: 0.6; }
    .task-checkbox { width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 6px; cursor: pointer; flex-shrink: 0; margin-top: 2px; display: flex; align-items: center; justify-content: center; }
    .task-checkbox:hover { border-color: var(--success); background: #d1fae5; }
    .task-checkbox.checked { background: var(--success); border-color: var(--success); color: white; }
    .task-main { flex: 1; min-width: 0; }
    .task-title-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .aging-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .aging-dot.fresh { background: var(--success); }
    .aging-dot.aging { background: var(--warning); }
    .aging-dot.stale { background: var(--danger); animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .task-title { font-weight: 600; font-size: 14px; flex: 1; }
    .task.completed .task-title { text-decoration: line-through; }
    .task-meta { display: flex; gap: 12px; flex-wrap: wrap; font-size: 12px; color: var(--text-muted); align-items: center; }
    .task-badge { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; background: var(--bg); }
    .task-badge.project { background: #e0e7ff; color: #4338ca; }
    .task-badge.tag { background: #fef3c7; color: #92400e; }
    .task-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
    .task:hover .task-actions { opacity: 1; }
    .task-action-btn { padding: 6px 8px; background: transparent; border: none; cursor: pointer; border-radius: 4px; font-size: 16px; transition: all 0.2s; color: var(--text-muted); }
    .task-action-btn:hover { background: var(--bg); color: var(--text); }
    .progress-bar { width: 100%; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; margin-top: 8px; }
    .progress-fill { height: 100%; background: var(--success); transition: width 0.3s ease; }
    
    /* Matrix */
    .matrix-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .quadrant { background: var(--panel); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
    .quadrant-header { padding: 14px 16px; font-weight: 700; font-size: 14px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
    .quadrant.do-first { border-top: 3px solid var(--danger); }
    .quadrant.schedule { border-top: 3px solid var(--warning); }
    .quadrant.delegate { border-top: 3px solid var(--success); }
    .quadrant.eliminate { border-top: 3px solid var(--accent); }
    .quadrant-content { padding: 12px; min-height: 200px; }
    .quadrant-count { background: var(--bg); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    
    /* Timer */
    .timer-float { position: fixed; bottom: 24px; right: 24px; background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%); padding: 20px; border-radius: 16px; box-shadow: var(--shadow-lg); color: white; min-width: 260px; }
    .timer-float.minimized { min-width: auto; padding: 16px; cursor: pointer; }
    .timer-float.minimized .timer-content { display: none; }
    .timer-display { font-size: 36px; font-weight: 700; text-align: center; margin: 12px 0; font-variant-numeric: tabular-nums; }
    .timer-controls { display: flex; gap: 8px; justify-content: center; }
    .timer-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
    .timer-btn:hover { background: rgba(255,255,255,0.3); }
    .timer-info { text-align: center; margin-top: 12px; font-size: 13px; opacity: 0.9; }
    
    /* Next Task Hero Card */
    .hero-card {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      color: white;
      max-width: 500px;
      width: 90%;
      z-index: 2000;
      animation: heroIn 0.4s ease;
      display: none;
    }
    
    .hero-card.open { display: block; }
    
    @keyframes heroIn {
      from { opacity: 0; transform: translate(-50%, -40%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    
    .hero-badge {
      background: rgba(255,255,255,0.2);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
    }
    
    .hero-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.3;
    }
    
    .hero-reasons {
      background: rgba(255,255,255,0.15);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
    }
    
    .hero-reason {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .hero-reason:last-child { margin-bottom: 0; }
    
    .hero-reason-icon {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .hero-actions {
      display: flex;
      gap: 12px;
    }
    
    .hero-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .hero-btn-primary {
      background: white;
      color: #667eea;
    }
    
    .hero-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .hero-btn-secondary {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .hero-btn-secondary:hover {
      background: rgba(255,255,255,0.3);
    }
    
    /* Daily Check-in Banner */
    .checkin-banner {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      padding: 16px 20px;
      border-radius: 12px;
      color: white;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-md);
      animation: slideDown 0.4s ease;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .checkin-content {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .checkin-icon {
      font-size: 32px;
    }
    
    .checkin-text h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }
    
    .checkin-text p {
      margin: 4px 0 0 0;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .checkin-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    
    .checkin-close:hover {
      background: rgba(255,255,255,0.3);
    }
    
    /* Streak details modal */ 
    .streak-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
      backdrop-filter: blur(4px);
    }
     .streak-note {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 16px;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      text-align: center;
    }
    
    .streak-modal.open { display: flex; }
    
    .streak-content {
      background: var(--panel);
      padding: 32px;
      border-radius: 16px;
      box-shadow: var(--shadow-xl);
      max-width: 500px;
      width: 90%;
      animation: modalIn 0.2s ease;
    }
    
    .streak-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 20px;
    }
    
    .streak-day {
      aspect-ratio: 1;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      border: 2px solid var(--border);
      transition: all 0.2s;
    }
    
    .streak-day.active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-color: #10b981;
      transform: scale(1.05);
    }
    
    .streak-day-label {
      font-size: 10px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    
    .streak-day-count {
      font-size: 16px;
      font-weight: 700;
    }
    
    /* Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--panel); border-radius: 16px; box-shadow: var(--shadow-lg); width: 90%; max-width: 600px; max-height: 85vh; overflow-y: auto; animation: modalIn 0.2s ease; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 20px; font-weight: 700; margin: 0; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted); padding: 4px; }
    .modal-body { padding: 24px; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; }
    .form-input { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.2s; }
    .form-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
    textarea.form-input { resize: vertical; min-height: 80px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; gap: 10px; }
    .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
    .empty-icon { font-size: 64px; opacity: 0.3; margin-bottom: 16px; }
    .hidden { display: none !important; }
    
    /* Command Palette */
    .command-palette { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: var(--panel); border-radius: 12px; box-shadow: var(--shadow-lg); width: 90%; max-width: 600px; z-index: 1200; display: none; }
    .command-palette.open { display: block; animation: modalIn 0.2s ease; }
    .command-input { width: 100%; padding: 20px; border: none; font-size: 16px; border-bottom: 1px solid var(--border); }
    .command-input:focus { outline: none; }
    .command-results { max-height: 400px; overflow-y: auto; padding: 8px; }
    .command-item { padding: 12px 16px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: background 0.2s; }
    .command-item:hover { background: var(--accent-light); }
    
    .subtask-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 6px; margin-bottom: 6px; background: var(--bg); }
    .tags-container { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
    .tag-chip { background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 12px; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; }
    .tag-chip button { background: none; border: none; padding: 0; cursor: pointer; color: inherit; font-size: 14px; line-height: 1; }
    
    .project-card { background: var(--bg); padding: 16px; border-radius: 10px; margin-bottom: 12px; border: 1px solid var(--border); }
    .project-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
    .project-name { font-weight: 700; font-size: 16px; }
    .history-item { padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; border-left: 3px solid var(--success); }
    
    @media (max-width: 768px) {
      .sidebar { position: fixed; left: -240px; top: 0; bottom: 0; z-index: 999; transition: left 0.3s; }
      .sidebar.open { left: 0; }
      .matrix-grid { grid-template-columns: 1fr; }
      .timer-float { bottom: 16px; right: 16px; min-width: 220px; }
      .search-kbd { display: none; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 100 100" aria-hidden="true">
          <rect x="8" y="8" width="38" height="38" rx="6" fill="#ef4444"/>
          <rect x="54" y="8" width="38" height="38" rx="6" fill="#f59e0b"/>
          <rect x="8" y="54" width="38" height="38" rx="6" fill="#10b981"/>
          <rect x="54" y="54" width="38" height="38" rx="6" fill="#3b82f6"/>
        </svg>
        <h1>PrioBox</h1>
      </div>
      <nav class="nav" role="menu">
        <div class="nav-item active" data-view="dashboard" role="menuitem" tabindex="0" aria-label="Dashboard view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
          </svg></span><span>Dashboard</span></div>
        <div class="nav-item" data-view="focus" role="menuitem" tabindex="0" aria-label="Focus mode view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
          </svg></span><span>Focus Mode</span><span class="nav-badge" id="focusCount" aria-label="Focus tasks count">0</span></div>
        <div class="nav-item" data-view="matrix" role="menuitem" tabindex="0" aria-label="Matrix view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="2" x2="12" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/>
          </svg></span><span>Matrix View</span></div>
        <div class="nav-item" data-view="projects" role="menuitem" tabindex="0" aria-label="Projects view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
          </svg></span><span>Projects</span></div>
        <div class="nav-item" data-view="history" role="menuitem" tabindex="0" aria-label="Completed tasks view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg></span><span>Completed</span></div>
        <div class="nav-item" data-view="insights" role="menuitem" tabindex="0" aria-label="Insights and analytics view"><span class="nav-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>
          </svg></span><span>Insights</span></div>
      </nav>
      <div class="sidebar-footer">
        <button class="btn btn-primary" style="width: 100%; margin-bottom: 12px;" id="quickAddTopBtn" aria-label="Quick add new task">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          <span>Quick Add</span>
        </button>
        <button class="btn" style="width: 100%;" id="newTaskBtn" aria-label="Create new task with full details">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          <span>New Task</span>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" role="main">
      <div class="top-bar">
        <div class="search-bar" role="search">
          <label for="searchInput" class="hidden" style="position: absolute; left: -10000px;">Search tasks</label>
          <span class="search-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </span>
          <input type="search" placeholder="Search tasks or quick add..." id="searchInput" aria-label="Search tasks or create new task">
          <span class="search-kbd" aria-hidden="true">‚åòK</span>
        </div>
        <button class="btn" id="autoPrioritizeBtn" aria-label="Auto-prioritize tasks based on AI algorithm">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          <span>Auto-Prioritize</span>
        </button>
        <button class="btn btn-icon" id="filterBtn" title="Filter tasks" aria-label="Filter tasks">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
          </svg>
        </button>

        <!-- Export button inserted by feature -->
        <button class="btn" id="exportBtn" aria-label="Export tasks" title="Export tasks">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Export
        </button>

        <!-- Theme toggle button -->
        <button class="btn btn-icon" id="themeToggleBtn" aria-pressed="false" aria-label="Toggle dark mode" title="Toggle dark mode" style="display:flex;align-items:center;justify-content:center;">
          <!-- Sun icon (light) -->
          <svg id="themeIconSun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/>
          </svg>
          <!-- Moon icon (dark) -->
          <svg id="themeIconMoon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>

      <div class="content-area" id="contentArea">
        <!-- Daily Check-in Banner -->
        <div id="checkinBanner" class="checkin-banner hidden">
          <div class="checkin-content">
            <div class="checkin-icon">üéâ</div>
            <div class="checkin-text">
              <h3 id="checkinTitle">Welcome back!</h3>
              <p id="checkinSubtitle">You're on a roll. Keep it going!</p>
            </div>
          </div>
          <button class="checkin-close" id="closeCheckin">Got it</button>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView">
          <div class="stats-bar">
            <div class="stat-mini" style="cursor: pointer;" id="streakCard">
              <div>
                <div class="stat-mini-label">Consistency Streak</div>
                <div class="stat-mini-value" style="display: flex; align-items: center; gap: 8px;">
                  <span style="font-size: 28px;">üî•</span>
                  <span id="streakValue">0/7</span>
                </div>
              </div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">This Week</div><div class="stat-mini-value" id="weeklyCompleted">0</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">Today</div><div class="stat-mini-value" id="todayCount">0</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">Stale Tasks</div><div class="stat-mini-value" id="staleCount">0</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                <span>Smart Priority Queue</span>
              </div>
              <div class="section-actions">
                <button class="btn btn-primary" id="showNextTaskBtn" style="font-size: 13px; padding: 8px 16px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
                  </svg>
                  What's Next?
                </button>
                <button class="btn btn-icon" id="refreshPriority">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="section-content"><div class="task-list" id="priorityQueue"></div></div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span>Matrix Overview</span>
              </div>
            </div>
            <div class="section-content">
              <div class="matrix-grid">
                <div class="quadrant do-first">
                  <div class="quadrant-header">
                    <span>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                        <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
                      </svg>
                      Do First
                    </span>
                    <span class="quadrant-count" id="countDoFirst">0</span>
                  </div>
                  <div class="quadrant-content"><div class="task-list" id="quickDoFirst"></div></div>
                </div>
                <div class="quadrant schedule">
                  <div class="quadrant-header">
                    <span>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                      </svg>
                      Schedule
                    </span>
                    <span class="quadrant-count" id="countSchedule">0</span>
                  </div>
                  <div class="quadrant-content"><div class="task-list" id="quickSchedule"></div></div>
                </div>
                <div class="quadrant delegate">
                  <div class="quadrant-header">
                    <span>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                      </svg>
                      Delegate
                    </span>
                    <span class="quadrant-count" id="countDelegate">0</span>
                  </div>
                  <div class="quadrant-content"><div class="task-list" id="quickDelegate"></div></div>
                </div>
                <div class="quadrant eliminate">
                  <div class="quadrant-header">
                    <span>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      </svg>
                      Eliminate
                    </span>
                    <span class="quadrant-count" id="countEliminate">0</span>
                  </div>
                  <div class="quadrant-content"><div class="task-list" id="quickEliminate"></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Focus Mode -->
        <div id="focusView" class="hidden">
          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
                </svg>
                <span>Today's Focus</span>
              </div>
            </div>
            <div class="section-content"><div class="task-list" id="focusList"></div></div>
          </div>
        </div>

        <!-- Matrix View -->
        <div id="matrixView" class="hidden">
          <div class="matrix-grid">
            <div class="quadrant do-first">
              <div class="quadrant-header">
                <span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                    <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
                  </svg>
                  Do First
                </span>
                <span class="quadrant-count" id="fullCountDoFirst">0</span>
              </div>
              <div class="quadrant-content"><div class="task-list" id="fullDoFirst"></div></div>
            </div>
            <div class="quadrant schedule">
              <div class="quadrant-header">
                <span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                  Schedule
                </span>
                <span class="quadrant-count" id="fullCountSchedule">0</span>
              </div>
              <div class="quadrant-content"><div class="task-list" id="fullSchedule"></div></div>
            </div>
            <div class="quadrant delegate">
              <div class="quadrant-header">
                <span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  Delegate
                </span>
                <span class="quadrant-count" id="fullCountDelegate">0</span>
              </div>
              <div class="quadrant-content"><div class="task-list" id="fullDelegate"></div></div>
            </div>
            <div class="quadrant eliminate">
              <div class="quadrant-header">
                <span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                  Eliminate
                </span>
                <span class="quadrant-count" id="fullCountEliminate">0</span>
              </div>
              <div class="quadrant-content"><div class="task-list" id="fullEliminate"></div></div>
            </div>
          </div>
        </div>

        <!-- Projects View -->
        <div id="projectsView" class="hidden">
          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                <span>Projects</span>
              </div>
            </div>
            <div class="section-content" id="projectsList"></div>
          </div>
        </div>

        <!-- History View -->
        <div id="historyView" class="hidden">
          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
                <span>Completed Tasks</span>
              </div>
            </div>
            <div class="section-content" id="historyList"></div>
          </div>
        </div>

        <!-- Insights View -->
        <div id="insightsView" class="hidden">
          <div class="stats-bar">
            <div class="stat-mini">
              <div><div class="stat-mini-label">Total Tasks</div><div class="stat-mini-value" id="insightTotalTasks">0</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">Completion Rate</div><div class="stat-mini-value" id="insightCompletionRate">0%</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">Avg. Time to Complete</div><div class="stat-mini-value" id="insightAvgTime">0d</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                </svg>
              </div>
            </div>
            <div class="stat-mini">
              <div><div class="stat-mini-label">Most Productive Day</div><div class="stat-mini-value" id="insightBestDay">‚Äî</div></div>
              <div class="stat-mini-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>
                </svg>
                <span>7-Day Activity</span>
              </div>
            </div>
            <div class="section-content">
              <div id="activityChart" style="display: flex; align-items: flex-end; justify-content: space-around; gap: 12px; height: 200px; padding: 20px;"></div>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
            <div class="section">
              <div class="section-header">
                <div class="section-title">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                  </svg>
                  <span>Tasks by Quadrant</span>
                </div>
              </div>
              <div class="section-content" id="quadrantBreakdown"></div>
            </div>

            <div class="section">
              <div class="section-header">
                <div class="section-title">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                  </svg>
                  <span>Top Projects</span>
                </div>
              </div>
              <div class="section-content" id="topProjects"></div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span>Aging Tasks Alert</span>
              </div>
            </div>
            <div class="section-content" id="agingTasks"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Floating Timer -->
  <div class="timer-float" id="timerFloat" role="complementary" aria-label="Focus timer widget">
    <div class="timer-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <span style="font-weight: 600;">Focus Timer</span>
        <button class="timer-btn" style="padding: 4px 8px; font-size: 11px;" id="timerMinimize" aria-label="Minimize timer">‚àí</button>
      </div>
      <div class="timer-display" id="timerDisplay" aria-live="polite" aria-atomic="true">25:00</div>
      <div class="timer-controls">
        <button class="timer-btn" id="timerStart" aria-label="Start focus timer">‚ñ∂ Start</button>
        <button class="timer-btn hidden" id="timerPause" aria-label="Pause focus timer">‚è∏ Pause</button>
        <button class="timer-btn" id="timerReset" aria-label="Reset focus timer">‚Üª Reset</button>
      </div>
      <div class="timer-info" aria-live="polite">Sessions today: <strong id="sessionsToday">0</strong></div>
    </div>
    <div id="timerMinimizedContent" class="hidden" aria-label="Timer minimized">‚è± <span id="timerMinDisplay">25:00</span></div>
  </div>
<!-- Streak Modal -->
  <div class="streak-modal" id="streakModal">
    <div class="streak-content">
      <h3 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: var(--text);">Your Consistency Streak</h3>
      <p style="margin: 0 0 20px 0; color: var(--text-muted); font-size: 14px;">Track your daily productivity momentum</p>
      <div class="streak-grid" id="streakGrid"></div>
      <div class="streak-note">
        A day counts as active if you complete 3+ tasks or log 1+ focus session
      </div>
      <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="closeStreakModal">Close</button>
    </div>
  </div>
  
  <!-- Task Modal -->
  <div class="modal-overlay" id="taskModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">New Task</h3>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="taskId">
        <div class="form-group">
          <label class="form-label">Task Title *</label>
          <input class="form-input" id="taskTitle" placeholder="What needs to be done?">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-input" id="taskDescription" placeholder="Add details..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Estimated Minutes</label>
            <input class="form-input" id="taskEstimate" type="number" min="1" placeholder="30">
          </div>
          <div class="form-group">
            <label class="form-label">Due Date</label>
            <input class="form-input" id="taskDue" type="date">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Quadrant</label>
          <select class="form-input" id="taskQuadrant">
            <option value="do-first">üî• Do First (Urgent & Important)</option>
            <option value="schedule">üìÖ Schedule (Important, Not Urgent)</option>
            <option value="delegate">üë• Delegate (Urgent, Not Important)</option>
            <option value="eliminate">üóëÔ∏è Eliminate (Neither)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Project</label>
          <input class="form-input" id="taskProject" placeholder="e.g., Website Redesign">
        </div>
        <div class="form-group">
          <label class="form-label">Tags</label>
          <div class="tags-container" id="taskTags"></div>
          <div style="display: flex; gap: 6px; margin-top: 8px;">
            <input class="form-input" id="newTag" placeholder="Add tag..." style="flex: 1;">
            <button class="btn" id="addTagBtn">+ Add</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Subtasks</label>
          <div id="subtasksList"></div>
          <div style="display: flex; gap: 6px; margin-top: 8px;">
            <input class="form-input" id="newSubtask" placeholder="Add subtask..." style="flex: 1;">
            <button class="btn" id="addSubtaskBtn">+ Add</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="deleteTaskBtn" style="background: var(--danger); color: white; border-color: var(--danger);">Delete</button>
        <div style="display: flex; gap: 10px;">
          <button class="btn" id="cancelTaskBtn">Cancel</button>
          <button class="btn btn-primary" id="saveTaskBtn">Save Task</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Command Palette -->
  <div class="command-palette" id="commandPalette">
    <input class="command-input" id="commandInput" placeholder="Type to search or create...">
    <div class="command-results" id="commandResults"></div>
  </div>

  <!-- Next Task Hero Card -->
  <div class="hero-card" id="heroCard">
    <div class="hero-badge">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 4px;">
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
      </svg>
      #1 Priority
    </div>
    <div class="hero-title" id="heroTaskTitle">Loading...</div>
    <div class="hero-reasons" id="heroReasons">
      <div class="hero-reason">
        <div class="hero-reason-icon">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </div>
        <span>Calculating priority...</span>
      </div>
    </div>
    <div class="hero-actions">
      <button class="hero-btn hero-btn-primary" id="heroStartBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 6px;">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
        Start Focus Session
      </button>
      <button class="hero-btn hero-btn-secondary" id="heroSkipBtn">Skip</button>
    </div>
  </div>

  <!-- Export modal inserted by feature -->
  <div class="modal-overlay hidden" id="exportModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
    <div class="modal" style="max-width:420px;">
      <div class="modal-header">
        <h3 class="modal-title" id="exportModalTitle">Export Tasks</h3>
        <button class="modal-close" id="exportModalClose" aria-label="Close export dialog">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Format</label>
          <select class="form-input" id="exportFormat">
            <option value="json">JSON (.json)</option>
            <option value="csv">CSV (.csv)</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Include</label>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <label><input type="checkbox" id="exportIncludeCompleted" checked> Completed tasks</label>
            <label><input type="checkbox" id="exportIncludeSubtasks" checked> Subtasks</label>
            <label><input type="checkbox" id="exportIncludeMeta" checked> Tags & Project</label>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Scope</label>
          <select class="form-input" id="exportScope">
            <option value="all">All tasks</option>
            <option value="visible">Visible list(s)</option>
            <option value="priority">Priority queue only</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="exportCancelBtn">Cancel</button>
        <button class="btn btn-primary" id="exportRunBtn">Export</button>
      </div>
    </div>
  </div>

  <!-- Theme toggle script (persists selection and respects system preference) -->
  <script>
    (function(){
      const THEME_KEY = 'prio-theme';
      const btn = document.getElementById('themeToggleBtn');
      const sun = document.getElementById('themeIconSun');
      const moon = document.getElementById('themeIconMoon');

      function applyTheme(theme) {
        if (theme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
          btn.setAttribute('aria-pressed', 'true');
          if (sun) sun.style.display = 'none';
          if (moon) moon.style.display = 'inline';
        } else {
          document.documentElement.removeAttribute('data-theme');
          btn.setAttribute('aria-pressed', 'false');
          if (sun) sun.style.display = 'inline';
          if (moon) moon.style.display = 'none';
        }
      }

      function init() {
        try {
          const stored = localStorage.getItem(THEME_KEY);
          if (stored === 'dark' || stored === 'light') {
            applyTheme(stored);
            return;
          }
        } catch (e) {
          // localStorage might be disabled
        }

        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(prefersDark ? 'dark' : 'light');
      }

      if (btn) {
        btn.addEventListener('click', function() {
          const current = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          applyTheme(next);
          try { localStorage.setItem(THEME_KEY, next); } catch (e) {}
        });
      }

      // initialize on load
      init();
    })();
  </script>

  <!-- Inline export script (client-side JSON + CSV export) -->
  <script>
  (function() {
    function downloadFile(filename, content, mime) {
      const blob = new Blob([content], { type: mime || 'application/octet-stream' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function gatherTasks({ includeCompleted, includeSubtasks, scope }) {
      const containers = [];
      if (scope === 'priority') {
        containers.push(document.getElementById('priorityQueue'));
      } else if (scope === 'visible') {
        document.querySelectorAll('.task-list').forEach(el => { if (el && el.offsetParent !== null) containers.push(el); });
      } else {
        document.querySelectorAll('.task-list').forEach(el => containers.push(el));
      }

      const seen = new Set();
      const tasks = [];

      containers.forEach(container => {
        if (!container) return;
        container.querySelectorAll('.task').forEach(taskEl => {
          if (seen.has(taskEl)) return;
          seen.add(taskEl);

          const dataId = taskEl.getAttribute('data-id') || taskEl.dataset.id || '';
          const titleEl = taskEl.querySelector('.task-title');
          const title = titleEl ? titleEl.textContent.trim() : (taskEl.getAttribute('data-title') || taskEl.dataset.title || '').trim();
          const completed = taskEl.classList.contains('completed') || taskEl.getAttribute('data-completed') === 'true' || taskEl.dataset.completed === 'true';
          if (!includeCompleted && completed) return;

          const projectEl = taskEl.querySelector('.task-badge.project');
          const project = projectEl ? projectEl.textContent.trim() : (taskEl.dataset.project || '').trim();
          const tagEls = taskEl.querySelectorAll('.task-badge.tag');
          const tags = tagEls.length ? Array.from(tagEls).map(t => t.textContent.trim()) : (taskEl.dataset.tags ? String(taskEl.dataset.tags).split(',').map(s => s.trim()).filter(Boolean) : []);

          const descEl = taskEl.querySelector('.task-description') || taskEl.querySelector('.description') || null;
          const description = descEl ? descEl.textContent.trim() : (taskEl.getAttribute('data-description') || taskEl.dataset.description || '');

          let subtasks = [];
          if (includeSubtasks) {
            const subEls = taskEl.querySelectorAll('.subtask-item, .subtask');
            if (subEls && subEls.length) {
              subtasks = Array.from(subEls).map(s => {
                const title = s.textContent.trim();
                const completed = s.classList.contains('completed') || (s.querySelector('input[type="checkbox"]') && s.querySelector('input[type="checkbox"]').checked) || false;
                return { title, completed };
              });
            } else if (taskEl.dataset.subtasks) {
              try { subtasks = JSON.parse(taskEl.dataset.subtasks); } catch (e) { subtasks = []; }
            }
          }

          let quadrant = '';
          const quadr = taskEl.closest('.quadrant');
          if (quadr) {
            const header = quadr.querySelector('.quadrant-header');
            if (header) {
              const titleSpan = header.querySelector('span') || header;
              quadrant = titleSpan ? titleSpan.textContent.trim() : '';
            }
          } else {
            const c = taskEl.closest('#priorityQueue, #quickDoFirst, #quickSchedule, #quickDelegate, #quickEliminate, #fullDoFirst, #fullSchedule, #fullDelegate, #fullEliminate, #focusList, #historyList');
            if (c && c.id) quadrant = c.id;
          }

          const metaEl = taskEl.querySelector('.task-meta');
          const meta = metaEl ? metaEl.textContent.trim() : '';

          tasks.push({
            id: dataId || '',
            title: title || '',
            description: description || '',
            completed: !!completed,
            quadrant: quadrant || '',
            project: project || '',
            tags: tags || [],
            meta: meta || '',
            subtasks: subtasks || []
          });
        });
      });

      return tasks;
    }

    function tasksToCSV(tasks) {
      const escape = v => {
        if (v === null || v === undefined) return '';
        const s = typeof v === 'string' ? v : String(v);
        return '"' + s.replace(/"/g, '""') + '"';
      };

      const headers = ['id','title','description','completed','quadrant','project','tags','meta','subtasks'];
      const rows = [headers.join(',')];

      tasks.forEach(t => {
        const row = [
          escape(t.id),
          escape(t.title),
          escape(t.description),
          escape(t.completed ? 'true' : 'false'),
          escape(t.quadrant),
          escape(t.project),
          escape(t.tags.join('|')),
          escape(t.meta),
          escape(JSON.stringify(t.subtasks || []))
        ];
        rows.push(row.join(','));
      });

      return rows.join('\n');
    }

    function openExportModal() {
      const modal = document.getElementById('exportModal');
      if (!modal) { runExport(); return; }
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden', 'false');
    }

    function closeExportModal() {
      const modal = document.getElementById('exportModal');
      if (!modal) return;
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden', 'true');
    }

    function runExport() {
      const fmt = document.getElementById('exportFormat') ? document.getElementById('exportFormat').value : 'json';
      const includeCompleted = document.getElementById('exportIncludeCompleted') ? document.getElementById('exportIncludeCompleted').checked : true;
      const includeSubtasks = document.getElementById('exportIncludeSubtasks') ? document.getElementById('exportIncludeSubtasks').checked : true;
      const includeMeta = document.getElementById('exportIncludeMeta') ? document.getElementById('exportIncludeMeta').checked : true;
      const scope = document.getElementById('exportScope') ? document.getElementById('exportScope').value : 'all';

      const tasks = gatherTasks({ includeCompleted, includeSubtasks, scope });

      if (!includeSubtasks) tasks.forEach(t => { delete t.subtasks; });
      if (!includeMeta) tasks.forEach(t => { delete t.project; delete t.tags; delete t.meta; });

      const now = new Date();
      const stamp = now.toISOString().slice(0,19).replace(/[:T]/g,'-');
      if (fmt === 'csv') {
        const csv = tasksToCSV(tasks);
        downloadFile(`priobox-tasks-${stamp}.csv`, csv, 'text/csv;charset=utf-8;');
      } else {
        const json = JSON.stringify({ exportedAt: new Date().toISOString(), count: tasks.length, tasks }, null, 2);
        downloadFile(`priobox-tasks-${stamp}.json`, json, 'application/json;charset=utf-8;');
      }
    }

    document.addEventListener('click', (e) => {
      if (e.target.closest && e.target.closest('#exportBtn')) openExportModal();
      if (e.target.closest && e.target.closest('#exportModalClose')) closeExportModal();
      if (e.target.closest && e.target.closest('#exportCancelBtn')) closeExportModal();
      if (e.target.closest && e.target.closest('#exportRunBtn')) { runExport(); closeExportModal(); }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const modal = document.getElementById('exportModal');
        if (modal && !modal.classList.contains('hidden')) closeExportModal();
      }
    });

    window.prioboxExport = function(options) {
      const fmt = options && options.format ? options.format : 'json';
      const includeCompleted = options && typeof options.includeCompleted === 'boolean' ? options.includeCompleted : true;
      const includeSubtasks = options && typeof options.includeSubtasks === 'boolean' ? options.includeSubtasks : true;
      const includeMeta = options && typeof options.includeMeta === 'boolean' ? options.includeMeta : true;
      const scope = options && options.scope ? options.scope : 'all';

      const tasks = gatherTasks({ includeCompleted, includeSubtasks, scope });
      if (!includeSubtasks) tasks.forEach(t => { delete t.subtasks; });
      if (!includeMeta) tasks.forEach(t => { delete t.project; delete t.tags; delete t.meta; });

      const now = new Date();
      const stamp = now.toISOString().slice(0,19).replace(/[:T]/g,'-');
      if (fmt === 'csv') {
        const csv = tasksToCSV(tasks);
        downloadFile(`priobox-tasks-${stamp}.csv`, csv, 'text/csv;charset=utf-8;');
      } else {
        const json = JSON.stringify({ exportedAt: new Date().toISOString(), count: tasks.length, tasks }, null, 2);
        downloadFile(`priobox-tasks-${stamp}.json`, json, 'application/json;charset=utf-8;');
      }
    };
  })();
  </script>
<script>
// Complete export functionality
document.addEventListener('DOMContentLoaded', function() {
  console.log('Export script loaded');
  
  // Export button click
  const exportBtn = document.getElementById('exportBtn');
  if (exportBtn) {
    exportBtn.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('Export button clicked!');
      const modal = document.getElementById('exportModal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.setAttribute('aria-hidden', 'false');
        console.log('Modal opened');
      }
    });
  }
  
  // Close modal button
  const closeBtn = document.getElementById('exportModalClose');
  if (closeBtn) {
    closeBtn.addEventListener('click', function(e) {
      e.preventDefault();
      const modal = document.getElementById('exportModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
      }
    });
  }
  
  // Cancel button
  const cancelBtn = document.getElementById('exportCancelBtn');
  if (cancelBtn) {
    cancelBtn.addEventListener('click', function(e) {
      e.preventDefault();
      const modal = document.getElementById('exportModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
      }
    });
  }
  
  // Run export button
  const runBtn = document.getElementById('exportRunBtn');
  if (runBtn) {
    runBtn.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('Running export...');
      
      // Call the export function from the main script
      if (typeof window.prioboxExport === 'function') {
        const fmt = document.getElementById('exportFormat').value;
        const includeCompleted = document.getElementById('exportIncludeCompleted').checked;
        const includeSubtasks = document.getElementById('exportIncludeSubtasks').checked;
        const includeMeta = document.getElementById('exportIncludeMeta').checked;
        const scope = document.getElementById('exportScope').value;
        
        window.prioboxExport({
          format: fmt,
          includeCompleted: includeCompleted,
          includeSubtasks: includeSubtasks,
          includeMeta: includeMeta,
          scope: scope
        });
        
        // Close modal after export
        const modal = document.getElementById('exportModal');
        if (modal) {
          modal.classList.add('hidden');
          modal.setAttribute('aria-hidden', 'true');
        }
      }
    });
  }
  
  // ESC key to close modal
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const modal = document.getElementById('exportModal');
      if (modal && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
      }
    }
  });
});
</script>
  <script>
// ============================================================================
// PRIOBOX - COMPLETE APPLICATION LOGIC
// ============================================================================

(function() {
  'use strict';

  // ============================================================================
  // STATE MANAGEMENT
  // ============================================================================
  
  const STATE = {
    tasks: [],
    currentView: 'dashboard',
    editingTask: null,
    timer: {
      minutes: 25,
      seconds: 0,
      isRunning: false,
      interval: null,
      sessionsToday: 0
    },
    streak: {
      current: 0,
      lastDate: null,
      history: []
    }
  };

  // ============================================================================
  // UTILITY FUNCTIONS
  // ============================================================================
  
  function generateId() {
    return 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  }

  function formatDate(date) {
    return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  }

  function getDaysAgo(date) {
    const now = new Date();
    const created = new Date(date);
    const diffTime = Math.abs(now - created);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays;
  }

  function getAgingStatus(task) {
    if (task.completed) return 'fresh';
    const days = getDaysAgo(task.createdAt);
    if (days <= 2) return 'fresh';
    if (days <= 5) return 'aging';
    return 'stale';
  }

  // ============================================================================
  // LOCAL STORAGE
  // ============================================================================
  
  function saveToStorage() {
    try {
      localStorage.setItem('priobox_tasks', JSON.stringify(STATE.tasks));
      localStorage.setItem('priobox_timer', JSON.stringify(STATE.timer.sessionsToday));
      localStorage.setItem('priobox_streak', JSON.stringify(STATE.streak));
    } catch (e) {
      console.error('Failed to save to localStorage:', e);
    }
  }

  function loadFromStorage() {
    try {
      const tasks = localStorage.getItem('priobox_tasks');
      const sessions = localStorage.getItem('priobox_timer');
      const streak = localStorage.getItem('priobox_streak');
      
      if (tasks) STATE.tasks = JSON.parse(tasks);
      if (sessions) STATE.timer.sessionsToday = JSON.parse(sessions);
      if (streak) STATE.streak = JSON.parse(streak);
    } catch (e) {
      console.error('Failed to load from localStorage:', e);
    }
  }

  // ============================================================================
  // TASK MANAGEMENT
  // ============================================================================
  
  function createTask(taskData) {
    const task = {
      id: generateId(),
      title: taskData.title,
      description: taskData.description || '',
      quadrant: taskData.quadrant || 'do-first',
      project: taskData.project || '',
      tags: taskData.tags || [],
      subtasks: taskData.subtasks || [],
      estimate: taskData.estimate || 30,
      dueDate: taskData.dueDate || null,
      completed: false,
      createdAt: new Date().toISOString(),
      completedAt: null
    };
    
    STATE.tasks.push(task);
    saveToStorage();
    render();
    return task;
  }

  function updateTask(id, updates) {
    const task = STATE.tasks.find(t => t.id === id);
    if (task) {
      Object.assign(task, updates);
      saveToStorage();
      render();
    }
  }

  function deleteTask(id) {
    STATE.tasks = STATE.tasks.filter(t => t.id !== id);
    saveToStorage();
    render();
  }

  function toggleTaskComplete(id) {
    const task = STATE.tasks.find(t => t.id === id);
    if (task) {
      task.completed = !task.completed;
      task.completedAt = task.completed ? new Date().toISOString() : null;
      
      // Update streak
      if (task.completed) {
        updateStreak();
      }
      
      saveToStorage();
      render();
    }
  }

  function getTasksByQuadrant(quadrant) {
    return STATE.tasks.filter(t => t.quadrant === quadrant && !t.completed);
  }

  function getCompletedTasks() {
    return STATE.tasks.filter(t => t.completed);
  }

  function getPriorityQueue() {
    // Priority algorithm: urgent + important first, then by age
    const incomplete = STATE.tasks.filter(t => !t.completed);
    
    return incomplete.sort((a, b) => {
      const quadrantPriority = {
        'do-first': 4,
        'schedule': 3,
        'delegate': 2,
        'eliminate': 1
      };
      
      const priorityA = quadrantPriority[a.quadrant] || 0;
      const priorityB = quadrantPriority[b.quadrant] || 0;
      
      if (priorityA !== priorityB) return priorityB - priorityA;
      
      // If same quadrant, older tasks first
      return new Date(a.createdAt) - new Date(b.createdAt);
    });
  }

  // ============================================================================
  // STREAK TRACKING
  // ============================================================================
  
  function updateStreak() {
    const today = new Date().toDateString();
    const completedToday = STATE.tasks.filter(t => 
      t.completed && new Date(t.completedAt).toDateString() === today
    ).length;
    
    const sessionsToday = STATE.timer.sessionsToday;
    const isActiveDay = completedToday >= 3 || sessionsToday >= 1;
    
    if (isActiveDay) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = yesterday.toDateString();
      
      if (STATE.streak.lastDate === yesterdayStr || STATE.streak.lastDate === today) {
        if (STATE.streak.lastDate !== today) {
          STATE.streak.current++;
        }
      } else if (!STATE.streak.lastDate) {
        STATE.streak.current = 1;
      } else {
        STATE.streak.current = 1;
      }
      
      STATE.streak.lastDate = today;
      
      if (!STATE.streak.history.includes(today)) {
        STATE.streak.history.push(today);
      }
      
      saveToStorage();
    }
  }

  // ============================================================================
  // TIMER FUNCTIONALITY
  // ============================================================================
  
  function startTimer() {
    if (STATE.timer.isRunning) return;
    
    STATE.timer.isRunning = true;
    STATE.timer.interval = setInterval(() => {
      if (STATE.timer.seconds === 0) {
        if (STATE.timer.minutes === 0) {
          // Timer complete!
          stopTimer();
          STATE.timer.sessionsToday++;
          updateStreak();
          saveToStorage();
          alert('Focus session complete! Great work! üéâ');
          resetTimer();
          return;
        }
        STATE.timer.minutes--;
        STATE.timer.seconds = 59;
      } else {
        STATE.timer.seconds--;
      }
      updateTimerDisplay();
    }, 1000);
    
    updateTimerButtons();
  }

  function pauseTimer() {
    STATE.timer.isRunning = false;
    if (STATE.timer.interval) {
      clearInterval(STATE.timer.interval);
      STATE.timer.interval = null;
    }
    updateTimerButtons();
  }

  function resetTimer() {
    pauseTimer();
    STATE.timer.minutes = 25;
    STATE.timer.seconds = 0;
    updateTimerDisplay();
  }

  function stopTimer() {
    pauseTimer();
  }

  function updateTimerDisplay() {
    const display = document.getElementById('timerDisplay');
    const minDisplay = document.getElementById('timerMinDisplay');
    const formatted = `${String(STATE.timer.minutes).padStart(2, '0')}:${String(STATE.timer.seconds).padStart(2, '0')}`;
    
    if (display) display.textContent = formatted;
    if (minDisplay) minDisplay.textContent = formatted;
    
    const sessionsEl = document.getElementById('sessionsToday');
    if (sessionsEl) sessionsEl.textContent = STATE.timer.sessionsToday;
  }

  function updateTimerButtons() {
    const startBtn = document.getElementById('timerStart');
    const pauseBtn = document.getElementById('timerPause');
    
    if (STATE.timer.isRunning) {
      if (startBtn) startBtn.classList.add('hidden');
      if (pauseBtn) pauseBtn.classList.remove('hidden');
    } else {
      if (startBtn) startBtn.classList.remove('hidden');
      if (pauseBtn) pauseBtn.classList.add('hidden');
    }
  }

  // ============================================================================
  // VIEW MANAGEMENT
  // ============================================================================
  
  function switchView(viewName) {
    STATE.currentView = viewName;
    
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
      if (item.getAttribute('data-view') === viewName) {
        item.classList.add('active');
      }
    });
    
    // Hide all views
    const views = ['dashboardView', 'focusView', 'matrixView', 'projectsView', 'historyView', 'insightsView'];
    views.forEach(v => {
      const el = document.getElementById(v);
      if (el) el.classList.add('hidden');
    });
    
    // Show current view
    const currentViewEl = document.getElementById(viewName + 'View');
    if (currentViewEl) currentViewEl.classList.remove('hidden');
    
    render();
  }

  // ============================================================================
  // RENDERING
  // ============================================================================
  
  function renderTask(task) {
    const agingStatus = getAgingStatus(task);
    const subtasksComplete = task.subtasks.filter(st => st.completed).length;
    const subtasksTotal = task.subtasks.length;
    
    return `
      <div class="task ${task.completed ? 'completed' : ''}" data-id="${task.id}">
        <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-action="toggle">
          ${task.completed ? '‚úì' : ''}
        </div>
        <div class="task-main">
          <div class="task-title-row">
            <div class="aging-dot ${agingStatus}"></div>
            <div class="task-title">${task.title}</div>
          </div>
          <div class="task-meta">
            ${task.project ? `<span class="task-badge project">${task.project}</span>` : ''}
            ${task.tags.map(tag => `<span class="task-badge tag">${tag}</span>`).join('')}
            ${task.dueDate ? `<span>üìÖ ${formatDate(task.dueDate)}</span>` : ''}
            ${task.estimate ? `<span>‚è± ${task.estimate}m</span>` : ''}
          </div>
          ${subtasksTotal > 0 ? `
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${(subtasksComplete / subtasksTotal * 100)}%"></div>
            </div>
          ` : ''}
        </div>
        <div class="task-actions">
          <button class="task-action-btn" data-action="edit" title="Edit">‚úèÔ∏è</button>
          <button class="task-action-btn" data-action="delete" title="Delete">üóëÔ∏è</button>
        </div>
      </div>
    `;
  }

  function render() {
    // Update stats
    const incompleteTasks = STATE.tasks.filter(t => !t.completed);
    const completedThisWeek = STATE.tasks.filter(t => {
      if (!t.completed) return false;
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      return new Date(t.completedAt) > weekAgo;
    }).length;
    
    const staleTasks = incompleteTasks.filter(t => getAgingStatus(t) === 'stale').length;
    
    const todayCount = document.getElementById('todayCount');
    const weeklyCompleted = document.getElementById('weeklyCompleted');
    const staleCount = document.getElementById('staleCount');
    const streakValue = document.getElementById('streakValue');
    const focusCount = document.getElementById('focusCount');
    
    if (todayCount) todayCount.textContent = incompleteTasks.filter(t => t.quadrant === 'do-first').length;
    if (weeklyCompleted) weeklyCompleted.textContent = completedThisWeek;
    if (staleCount) staleCount.textContent = staleTasks;
    if (streakValue) streakValue.textContent = `${STATE.streak.current}/7`;
    if (focusCount) focusCount.textContent = incompleteTasks.filter(t => t.quadrant === 'do-first').length;
    
    // Render based on current view
    if (STATE.currentView === 'dashboard') {
      renderDashboard();
    } else if (STATE.currentView === 'focus') {
      renderFocus();
    } else if (STATE.currentView === 'matrix') {
      renderMatrix();
    } else if (STATE.currentView === 'projects') {
      renderProjects();
    } else if (STATE.currentView === 'history') {
      renderHistory();
    } else if (STATE.currentView === 'insights') {
      renderInsights();
    }
  }

  function renderDashboard() {
    const priorityQueue = getPriorityQueue().slice(0, 5);
    const queueEl = document.getElementById('priorityQueue');
    
    if (queueEl) {
      if (priorityQueue.length === 0) {
        queueEl.innerHTML = '<div class="empty-state"><div class="empty-icon">‚ú®</div><p>No tasks yet. Click "New Task" to get started!</p></div>';
      } else {
        queueEl.innerHTML = priorityQueue.map(renderTask).join('');
      }
    }
    
    // Render quick quadrants
    ['do-first', 'schedule', 'delegate', 'eliminate'].forEach(quadrant => {
      const tasks = getTasksByQuadrant(quadrant).slice(0, 3);
      const container = document.getElementById('quick' + quadrant.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(''));
      const countEl = document.getElementById('count' + quadrant.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(''));
      
      if (container) {
        if (tasks.length === 0) {
          container.innerHTML = '<div class="empty-state" style="padding: 20px;"><p style="font-size: 13px; margin: 0;">No tasks</p></div>';
        } else {
          container.innerHTML = tasks.map(renderTask).join('');
        }
      }
      
      if (countEl) {
        countEl.textContent = getTasksByQuadrant(quadrant).length;
      }
    });
  }

  function renderFocus() {
    const focusTasks = getTasksByQuadrant('do-first');
    const container = document.getElementById('focusList');
    
    if (container) {
      if (focusTasks.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">üéØ</div><p>No urgent & important tasks. Great job!</p></div>';
      } else {
        container.innerHTML = focusTasks.map(renderTask).join('');
      }
    }
  }

  function renderMatrix() {
    ['do-first', 'schedule', 'delegate', 'eliminate'].forEach(quadrant => {
      const tasks = getTasksByQuadrant(quadrant);
      const container = document.getElementById('full' + quadrant.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(''));
      const countEl = document.getElementById('fullCount' + quadrant.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(''));
      
      if (container) {
        if (tasks.length === 0) {
          container.innerHTML = '<div class="empty-state" style="padding: 20px;"><p style="font-size: 13px; margin: 0;">No tasks</p></div>';
        } else {
          container.innerHTML = tasks.map(renderTask).join('');
        }
      }
      
      if (countEl) {
        countEl.textContent = tasks.length;
      }
    });
  }

  function renderProjects() {
    const projects = {};
    STATE.tasks.filter(t => t.project && !t.completed).forEach(task => {
      if (!projects[task.project]) projects[task.project] = [];
      projects[task.project].push(task);
    });
    
    const container = document.getElementById('projectsList');
    if (container) {
      if (Object.keys(projects).length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìÅ</div><p>No projects yet</p></div>';
      } else {
        container.innerHTML = Object.entries(projects).map(([name, tasks]) => `
          <div class="project-card">
            <div class="project-header">
              <div class="project-name">${name}</div>
              <div>${tasks.length} tasks</div>
            </div>
            ${tasks.map(renderTask).join('')}
          </div>
        `).join('');
      }
    }
  }

  function renderHistory() {
    const completed = getCompletedTasks().sort((a, b) => 
      new Date(b.completedAt) - new Date(a.completedAt)
    );
    
    const container = document.getElementById('historyList');
    if (container) {
      if (completed.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">‚úÖ</div><p>No completed tasks yet</p></div>';
      } else {
        container.innerHTML = completed.map(task => `
          <div class="history-item">
            <div style="font-weight: 600; margin-bottom: 4px;">${task.title}</div>
            <div style="font-size: 12px; color: var(--text-muted);">Completed ${formatDate(task.completedAt)}</div>
          </div>
        `).join('');
      }
    }
  }

  function renderInsights() {
    const total = STATE.tasks.length;
    const completed = STATE.tasks.filter(t => t.completed).length;
    const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    document.getElementById('insightTotalTasks').textContent = total;
    document.getElementById('insightCompletionRate').textContent = completionRate + '%';
    
    // Average time to complete
    const completedTasks = STATE.tasks.filter(t => t.completed && t.completedAt && t.createdAt);
    if (completedTasks.length > 0) {
      const avgDays = completedTasks.reduce((sum, t) => {
        const days = Math.ceil((new Date(t.completedAt) - new Date(t.createdAt)) / (1000 * 60 * 60 * 24));
        return sum + days;
      }, 0) / completedTasks.length;
      document.getElementById('insightAvgTime').textContent = Math.round(avgDays) + 'd';
    }
    
    // Activity chart (simplified)
    const chartEl = document.getElementById('activityChart');
    if (chartEl) {
      const last7Days = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        const count = STATE.tasks.filter(t => 
          t.completed && new Date(t.completedAt).toDateString() === dateStr
        ).length;
        last7Days.push({ day: date.toLocaleDateString('en-US', { weekday: 'short' }), count });
      }
      
      const maxCount = Math.max(...last7Days.map(d => d.count), 1);
      chartEl.innerHTML = last7Days.map(d => `
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px;">
          <div style="background: var(--accent); width: 100%; border-radius: 4px 4px 0 0; height: ${(d.count / maxCount) * 100}%;"></div>
          <div style="font-size: 11px; font-weight: 600;">${d.day}</div>
          <div style="font-size: 10px; color: var(--text-muted);">${d.count}</div>
        </div>
      `).join('');
    }
  }

  // ============================================================================
  // MODAL MANAGEMENT
  // ============================================================================
  
  function openTaskModal(taskId = null) {
    const modal = document.getElementById('taskModal');
    const title = document.getElementById('modalTitle');
    const deleteBtn = document.getElementById('deleteTaskBtn');
    
    if (taskId) {
      STATE.editingTask = STATE.tasks.find(t => t.id === taskId);
      title.textContent = 'Edit Task';
      deleteBtn.style.display = 'block';
      
      // Populate form
      document.getElementById('taskTitle').value = STATE.editingTask.title;
      document.getElementById('taskDescription').value = STATE.editingTask.description || '';
      document.getElementById('taskEstimate').value = STATE.editingTask.estimate || '';
      document.getElementById('taskDue').value = STATE.editingTask.dueDate || '';
      document.getElementById('taskQuadrant').value = STATE.editingTask.quadrant;
      document.getElementById('taskProject').value = STATE.editingTask.project || '';
      
      // Tags
      const tagsContainer = document.getElementById('taskTags');
      tagsContainer.innerHTML = STATE.editingTask.tags.map(tag => 
        `<span class="tag-chip">${tag} <button onclick="removeTag('${tag}')">√ó</button></span>`
      ).join('');
      
      // Subtasks
      const subtasksContainer = document.getElementById('subtasksList');
      subtasksContainer.innerHTML = STATE.editingTask.subtasks.map((st, i) => 
        `<div class="subtask-item">
          <input type="checkbox" ${st.completed ? 'checked' : ''} onchange="toggleSubtask(${i})">
          <span>${st.title}</span>
        </div>`
      ).join('');
    } else {
      STATE.editingTask = null;
      title.textContent = 'New Task';
      deleteBtn.style.display = 'none';
      
      // Clear form
      document.getElementById('taskTitle').value = '';
      document.getElementById('taskDescription').value = '';
      document.getElementById('taskEstimate').value = '';
      document.getElementById('taskDue').value = '';
      document.getElementById('taskQuadrant').value = 'do-first';
      document.getElementById('taskProject').value = '';
      document.getElementById('taskTags').innerHTML = '';
      document.getElementById('subtasksList').innerHTML = '';
    }
    
    modal.classList.add('open');
  }

  function closeTaskModal() {
    const modal = document.getElementById('taskModal');
    modal.classList.remove('open');
    STATE.editingTask = null;
  }

  function saveTask() {
    const title = document.getElementById('taskTitle').value.trim();
    if (!title) {
      alert('Please enter a task title');
      return;
    }
    
    const taskData = {
      title,
      description: document.getElementById('taskDescription').value.trim(),
      estimate: parseInt(document.getElementById('taskEstimate').value) || 30,
      dueDate: document.getElementById('taskDue').value || null,
      quadrant: document.getElementById('taskQuadrant').value,
      project: document.getElementById('taskProject').value.trim(),
      tags: STATE.editingTask ? STATE.editingTask.tags : [],
      subtasks: STATE.editingTask ? STATE.editingTask.subtasks : []
    };
    
    if (STATE.editingTask) {
      updateTask(STATE.editingTask.id, taskData);
    } else {
      createTask(taskData);
    }
    
    closeTaskModal();
  }

  // ============================================================================
  // EVENT HANDLERS
  // ============================================================================
  
  function initEventListeners() {
    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const view = item.getAttribute('data-view');
        if (view) switchView(view);
      });
    });
    
    // Task buttons
    const newTaskBtn = document.getElementById('newTaskBtn');
    const quickAddBtn = document.getElementById('quickAddTopBtn');
    if (newTaskBtn) newTaskBtn.addEventListener('click', () => openTaskModal());
    if (quickAddBtn) quickAddBtn.addEventListener('click', () => openTaskModal());
    
    // Modal buttons
    const modalClose = document.getElementById('modalClose');
    const cancelBtn = document.getElementById('cancelTaskBtn');
    const saveBtn = document.getElementById('saveTaskBtn');
    const deleteBtn = document.getElementById('deleteTaskBtn');
    
    if (modalClose) modalClose.addEventListener('click', closeTaskModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeTaskModal);
    if (saveBtn) saveBtn.addEventListener('click', saveTask);
    if (deleteBtn) deleteBtn.addEventListener('click', () => {
      if (STATE.editingTask && confirm('Delete this task?')) {
        deleteTask(STATE.editingTask.id);
        closeTaskModal();
      }
    });
    
    // Timer buttons
    const timerStart = document.getElementById('timerStart');
    const timerPause = document.getElementById('timerPause');
    const timerReset = document.getElementById('timerReset');
    const timerMinimize = document.getElementById('timerMinimize');
    const timerFloat = document.getElementById('timerFloat');
    
    if (timerStart) timerStart.addEventListener('click', startTimer);
    if (timerPause) timerPause.addEventListener('click', pauseTimer);
    if (timerReset) timerReset.addEventListener('click', resetTimer);
    if (timerMinimize) timerMinimize.addEventListener('click', () => {
      timerFloat.classList.toggle('minimized');
    });
    
    // Task interactions (event delegation)
    document.addEventListener('click', (e) => {
      const taskEl = e.target.closest('.task');
      if (!taskEl) return;
      
      const taskId = taskEl.getAttribute('data-id');
      const action = e.target.closest('[data-action]')?.getAttribute('data-action');
      
      if (action === 'toggle') {
        toggleTaskComplete(taskId);
      } else if (action === 'edit') {
        openTaskModal(taskId);
      } else if (action === 'delete') {
        if (confirm('Delete this task?')) {
          deleteTask(taskId);
        }
      }
    });
    
    // Tags
    const addTagBtn = document.getElementById('addTagBtn');
    const newTagInput = document.getElementById('newTag');
    if (addTagBtn) {
      addTagBtn.addEventListener('click', () => {
        const tag = newTagInput.value.trim();
        if (tag && STATE.editingTask) {
          if (!STATE.editingTask.tags.includes(tag)) {
            STATE.editingTask.tags.push(tag);
            const tagsContainer = document.getElementById('taskTags');
            tagsContainer.innerHTML += `<span class="tag-chip">${tag} <button onclick="removeTag('${tag}')">√ó</button></span>`;
          }
          newTagInput.value = '';
        }
      });
    }
    
    // Subtasks
    const addSubtaskBtn = document.getElementById('addSubtaskBtn');
    const newSubtaskInput = document.getElementById('newSubtask');
    if (addSubtaskBtn) {
      addSubtaskBtn.addEventListener('click', () => {
        const title = newSubtaskInput.value.trim();
        if (title && STATE.editingTask) {
          STATE.editingTask.subtasks.push({ title, completed: false });
          const container = document.getElementById('subtasksList');
          const i = STATE.editingTask.subtasks.length - 1;
          container.innerHTML += `
            <div class="subtask-item">
              <input type="checkbox" onchange="toggleSubtask(${i})">
              <span>${title}</span>
            </div>`;
          newSubtaskInput.value = '';
        }
      });
    }
    
    // What's Next button
    const showNextTaskBtn = document.getElementById('showNextTaskBtn');
    if (showNextTaskBtn) {
      showNextTaskBtn.addEventListener('click', () => {
        const nextTask = getPriorityQueue()[0];
        if (nextTask) {
          const heroCard = document.getElementById('heroCard');
          const heroTitle = document.getElementById('heroTaskTitle');
          const heroReasons = document.getElementById('heroReasons');
          
          heroTitle.textContent = nextTask.title;
          heroReasons.innerHTML = `
            <div class="hero-reason">
              <div class="hero-reason-icon">‚úì</div>
              <span>Highest priority in your queue</span>
            </div>
            <div class="hero-reason">
              <div class="hero-reason-icon">‚è∞</div>
              <span>${nextTask.estimate || 30} minutes estimated</span>
            </div>
          `;
          
          heroCard.classList.add('open');
        }
      });
    }
    
    // Hero card buttons
    const heroStartBtn = document.getElementById('heroStartBtn');
    const heroSkipBtn = document.getElementById('heroSkipBtn');
    const heroCard = document.getElementById('heroCard');
    
    if (heroStartBtn) {
      heroStartBtn.addEventListener('click', () => {
        heroCard.classList.remove('open');
        startTimer();
      });
    }
    
    if (heroSkipBtn) {
      heroSkipBtn.addEventListener('click', () => {
        heroCard.classList.remove('open');
});
}
// Streak card
const streakCard = document.getElementById('streakCard');
if (streakCard) {
  streakCard.addEventListener('click', () => {
    const modal = document.getElementById('streakModal');
    modal.classList.add('open');
    
    // Render streak grid
    const grid = document.getElementById('streakGrid');
    const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    grid.innerHTML = days.map(day => `
      <div class="streak-day ${STATE.streak.current >= days.indexOf(day) + 1 ? 'active' : ''}">
        <div class="streak-day-label">${day}</div>
        <div class="streak-day-count">${STATE.streak.current > days.indexOf(day) ? '‚úì' : ''}</div>
      </div>
    `).join('');
  });
}

const closeStreakModal = document.getElementById('closeStreakModal');
if (closeStreakModal) {
  closeStreakModal.addEventListener('click', () => {
    document.getElementById('streakModal').classList.remove('open');
  });
}
}
// Global functions for inline handlers
window.removeTag = function(tag) {
if (STATE.editingTask) {
STATE.editingTask.tags = STATE.editingTask.tags.filter(t => t !== tag);
const tagsContainer = document.getElementById('taskTags');
tagsContainer.innerHTML = STATE.editingTask.tags.map(t =>
<span class="tag-chip">${t} <button onclick="removeTag('${t}')">√ó</button></span>
).join('');
}
};
window.toggleSubtask = function(index) {
if (STATE.editingTask && STATE.editingTask.subtasks[index]) {
STATE.editingTask.subtasks[index].completed = !STATE.editingTask.subtasks[index].completed;
}
};
// ============================================================================
// INITIALIZATION
// ============================================================================
function init() {
console.log('üöÄ PrioBox initializing...');
loadFromStorage();
initEventListeners();
updateTimerDisplay();
render();
console.log('‚úÖ PrioBox ready!');
}
// Start the app when DOM is ready
if (document.readyState === 'loading') {
document.addEventListener('DOMContentLoaded', init);
} else {
init();
}
})();
</script>
</body>
</html>
